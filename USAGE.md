# 详细使用与排错教程 (面向非开发人员)

本教程旨在解决使用过程中可能遇到的细节问题。如果您是第一次使用，请优先阅读 [README.md](./README.md)。

---

## 1. 如何查找我的体重秤 Model ID？

如果您使用的不是 **小米体脂秤 S400**，或者默认的 `yunmai.scales.ms103` 无法获取数据，请按以下步骤查找：

1. 打开 **米家 (Mi Home)** 或 **小米运动健康 (Mi Fitness)** App。
2. 找到您的体重秤设备页面。
3. 点击右上角的三个点（设置）。
4. 在“关于设备”或“网络信息”中，通常可以看到类似 `yunmai.scales.xxx` 的字符串。
5. 将此字符串填入 `users.json` 中的 `model` 字段。

---

## 2. 佳明账号的区服说明 (Domain)

佳明在中国的服务器（Garmin.cn）是完全独立的。

- **如果您在 [Garmin.cn](https://www.garmin.cn) 注册的账号**：请务必将 `domain` 设置为 `"CN"`。
- **如果您是在国外网站注册的账号**：请将 `domain` 设置为 `"COM"`。
- **验证方法**：尝试在电脑浏览器登录 [Connect.garmin.cn](https://connect.garmin.cn)。如果能登录，说明是国内区；如果提示去国际站，说明是海外区。

---

## 3. 登录过程中的常见报错

### 3.1 验证码图片打不开
如果您运行 `login.py` 时没有自动弹出浏览器，或者弹出后图片加载失败：
- 检查终端输出，会显示图片保存的路径（如 `/tmp/tmpxxx.png`）。
- 手动去这个路径找到图片并打开。

### 3.2 2FA (二次验证) 失败
- 确保您的小米账号绑定的手机号可以正常接收短信。
- 输入验证码时动作要快，验证码通常有 5-10 分钟有效期。

---

## 4. 自动化运行 (长期方案)

### 在 Windows 上设置自动同步
1. 搜索并打开 **“任务计划程序”**。
2. 点击“创建基本任务”。
3. 名称填 `Xiaomi-Garmin-Sync`，频率选“每天”。
4. 操作选“启动程序”。
5. **程序/脚本** 填写：`C:\你的路径\.venv\Scripts\python.exe`
6. **添加参数** 填写：`C:\你的路径\src\main.py --sync`
7. **起始于** 填写项目根目录路径。

### 在 Mac 上设置自动同步
使用快捷指令或 `crontab -e` 命令添加：
```bash
0 8 * * * /Users/您的用户名/Desktop/garmin-sync/.venv/bin/python /Users/您的用户名/Desktop/garmin-sync/src/main.py --sync
```

---

## 5. 高级排错

### 5.1 查看详细日志
如果同步失败且没有报错信息，您可以尝试在运行命令时查看是否有错误提示：
通常程序会生成 `weight_data_{账户}.json`，如果该文件生成了但佳明没有数据，说明问题出在佳明授权或网络上。

### 5.2 重新登录 (重置环境)
如果遇到顽固的授权问题：
1. 删除项目根目录下的 `.garth/` 文件夹（佳明缓存）。
2. 在 `users.json` 中，把 `token` 对象里的内容清空。
3. 重新按照 [README.md](./README.md) 的步骤一登录。

---

## 6. 开发者联系与贡献
本项目是为了方便大家管理健康数据而开发的。如果您有改进建议或发现了 Bug，欢迎通过 GitHub 反馈。
